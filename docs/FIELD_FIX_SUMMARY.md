# Dify æ–‡ä»¶å­—æ®µåä¿®å¤æ€»ç»“

## ğŸ› å‘ç°çš„é—®é¢˜

åœ¨å¤šæ¨¡æ€åŠŸèƒ½æµ‹è¯•ä¸­å‘ç°ï¼Œå½“å‰å®ç°åœ¨ Dify æ–‡ä»¶æ ¼å¼ä¸­ä½¿ç”¨äº†é”™è¯¯çš„å­—æ®µåï¼š

```javascript
// æ—¥å¿—æ˜¾ç¤ºçš„é”™è¯¯æ ¼å¼
{
  "type": "image",
  "transfer_method": "local_file",
  "url": "9c5611d0-8ffc-4286-aa36-40c8748c04ac"  // âŒ é”™è¯¯
}
```

æ ¹æ® Dify çš„ API æ–‡æ¡£ï¼Œ`local_file` ç±»å‹åº”è¯¥ä½¿ç”¨ `upload_file_id` å­—æ®µï¼Œè€Œä¸æ˜¯ `url` å­—æ®µã€‚

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤ processMultimodalImages æ–¹æ³•

**æ–‡ä»¶**: `src/services/difyClient.js`

**ä¿®å¤å‰**:
```javascript
files.push({
  type: "image",
  transfer_method: "local_file",
  url: fileId  // âŒ é”™è¯¯å­—æ®µå
});
```

**ä¿®å¤å**:
```javascript
files.push({
  type: "image",
  transfer_method: "local_file", 
  upload_file_id: fileId  // âœ… æ­£ç¡®å­—æ®µå
});
```

### 2. å­—æ®µåè§„åˆ™è¯´æ˜

- **local_file**: ä½¿ç”¨ `upload_file_id` å­—æ®µ
- **remote_url**: ä½¿ç”¨ `url` å­—æ®µ

### 3. æ­£ç¡®çš„ Dify è¯·æ±‚æ ¼å¼

```json
{
  "inputs": {},
  "query": "æå–å›¾ç‰‡å†…å®¹",
  "response_mode": "streaming",
  "user": "app-xxxxx-dify-api-key",
  "files": [
    {
      "type": "image",
      "transfer_method": "local_file",
      "upload_file_id": "9c5611d0-8ffc-4286-aa36-40c8748c04ac"  // âœ… æ­£ç¡®
    }
  ]
}
```

## ğŸ§ª éªŒè¯æµ‹è¯•

åˆ›å»ºäº† `test-field-fix.js` æµ‹è¯•æ–‡ä»¶æ¥éªŒè¯ä¿®å¤ï¼š

1. **Base64 å›¾åƒæµ‹è¯•**: éªŒè¯ `local_file` ä½¿ç”¨ `upload_file_id`
2. **å¤–éƒ¨ URL æµ‹è¯•**: éªŒè¯ `remote_url` ä½¿ç”¨ `url`
3. **ç«¯åˆ°ç«¯æµ‹è¯•**: ç¡®ä¿æ•´ä¸ªå¤šæ¨¡æ€æµç¨‹æ­£å¸¸å·¥ä½œ

## ğŸ“Š å½±å“èŒƒå›´

- âœ… Base64 å›¾åƒä¸Šä¼ å¤„ç†
- âœ… å¤šæ¨¡æ€æ¶ˆæ¯è½¬æ¢
- âœ… Dify API è°ƒç”¨æ ¼å¼
- âœ… æ–‡ä»¶ä¼ è¾“æ–¹æ³•åŒºåˆ†

## ğŸ¯ é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼Œå¤šæ¨¡æ€è¯·æ±‚åº”è¯¥èƒ½å¤Ÿæ­£ç¡®åœ°ï¼š

1. ä¸Šä¼  base64 å›¾åƒåˆ° Dify
2. ä½¿ç”¨æ­£ç¡®çš„å­—æ®µåå‘é€æ–‡ä»¶ä¿¡æ¯
3. è·å¾— Dify çš„æ­£ç¡®å“åº”
4. å®Œæˆå›¾åƒåˆ†æä»»åŠ¡

---

**ä¿®å¤æ—¥æœŸ**: 2025å¹´1æœˆ2æ—¥  
**ä¿®å¤ç±»å‹**: å­—æ®µåç§°é”™è¯¯  
**ä¼˜å…ˆçº§**: é«˜ (å½±å“å¤šæ¨¡æ€åŠŸèƒ½æ ¸å¿ƒå·¥ä½œ)  
**çŠ¶æ€**: å·²å®Œæˆ âœ…
